

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>26. Memory reclaiming algorithms. &#8212; Introduction to Operating Systems</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'mm/reclamation';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="27. Page Sizes" href="page-size.html" />
    <link rel="prev" title="25. Page Tables" href="page-tables.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro/pref.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro/pref.html">
                    Preface
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro/intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/purpose.html">2. Purpose of operating systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/structure.html">3. Operating System Structure &amp; Unix/Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/abstractions.html">4. Operating System Abstractions</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/tools.html">5. What you should know</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/tools-shell.html">5.1. Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/tools-editors.html">5.2. Editors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/tools-make.html">5.3. Makefiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/tools-git.html">5.4. Git Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/tools-gdb.html">5.5. GDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/tools-c.html">5.6. The C Programming Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/tools-testing.html">5.7. Unit Tests</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Virtual Processor</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../scheduling/intro.html">6. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduling/process.html">7. Virtualizing a CPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduling/scheduling.html">8. Scheduling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduling/real_sched.html">9. A Look at the Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduling/review.html">10. Review</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">File Systems</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../fs/intro.html">11. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fs/interface.html">12. File System Abstraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fs/diskhw.html">13. A bit about Disks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fs/disklayout.html">14. File System Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fs/dl_track_used.html">15. Disk Layout:Tracking Used Space</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fs/dl_track_free.html">16. Disk Layout:Tracking Free Space</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fs/dl_name.html">17. Disk Layout:Implementing Name Space</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fs/dl_failures.html">18. Disk Layout:Dealing with Failures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fs/dl_ex_exx.html">19. Disk Layout:Examples of Real World File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fs/kernelimp.html">20. Kernel implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fs/review.html">21. Review</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Virtual Memory</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro.html">22. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="phys-and-seg.html">23. Memory management before paged virtual memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="virt-paging.html">24. Paging</a></li>
<li class="toctree-l1"><a class="reference internal" href="page-tables.html">25. Page Tables</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">26. Memory reclaiming algorithms.</a></li>
<li class="toctree-l1"><a class="reference internal" href="page-size.html">27. Page Sizes</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">28. Other topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="buffer-cache.html">29. Buffer Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="pagefaults.html">30. Memory Management Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="realworld.html">31. Memory management in the real world</a></li>
<li class="toctree-l1"><a class="reference internal" href="concl.html">32. Conclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="review.html">33. Review</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Concurrency</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../sync/sync.html">34. Introduction to Concurrency, Synchronization and Deadlock</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sync/sharing.html">35. Cooperating Processes and Inter-process Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sync/criticalsection.html">36. The Critical Section Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sync/locks.html">37. Implementing Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sync/ordering.html">38. Ordering Thread Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sync/concurrency_bugs.html">39. Common Concurrency Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sync/readmostly.html">40. Read-Dominated Workloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sync/hardware_challenges.html">41. Challenges of Modern Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sync/linux_locking.html">42. Locking in the Linux Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sync/review.html">43. Review</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Other Topics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../devices/devices.html">44. Input and Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devices/disk2.html">45. More on Disks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/virt.html">46. Virtualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec/sec.html">47. Security</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../misc/howto.html">48. How to read this book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/Contributing.html">49. Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/bib.html">50. Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://jupyterhub-opf-jupyterhub.apps.smaug.na.operate-first.cloud/hub/user-redirect/git-pull?repo=https%3A//github.com/OpenOSOrg/openos&urlpath=lab/tree/openos/content/mm/reclamation.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onJupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/OpenOSOrg/openos" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/OpenOSOrg/openos/edit/main/content/mm/reclamation.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/OpenOSOrg/openos/issues/new?title=Issue%20on%20page%20%2Fmm/reclamation.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/mm/reclamation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Memory reclaiming algorithms.</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-memory-hierarchy">26.1. The Memory Hierarchy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dirty-and-clean-pages">26.2. Dirty and Clean Pages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#page-replacement">26.3. Page Replacement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#page-replacement-strategies">26.4. Page Replacement Strategies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fifo">26.4.1. FIFO</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lru">26.4.2. LRU</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#opt">26.4.3. OPT</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fifo-with-second-chance-clock">26.4.4. FIFO with Second Chance (CLOCK)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#clock">26.4.5. CLOCK</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="memory-reclaiming-algorithms">
<span id="cont-mm-reclamation"></span><h1><span class="section-number">26. </span>Memory reclaiming algorithms.<a class="headerlink" href="#memory-reclaiming-algorithms" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p>Global page reclaiming</p>
<ul>
<li><p>FIFO, LRU, NRU…</p></li>
</ul>
</li>
<li><p>Local page reclaiming</p>
<ul>
<li><p>Reclaiming within a specific address space</p></li>
</ul>
</li>
<li><p>Working set page reclaiming</p></li>
</ul>
<section id="the-memory-hierarchy">
<h2><span class="section-number">26.1. </span>The Memory Hierarchy<a class="headerlink" href="#the-memory-hierarchy" title="Permalink to this headline">#</a></h2>
<p>Demand paging from files and from swap provides the mechanisms to create
the traditional memory hierarchy, as shown in
(#fig:vm:pic108).</p>
<hr class="docutils" />
<figure class="align-default" id="fig-vm-fig108">
<a class="reference internal image-reference" href="../_images/virt-mem-pic108.png"><img alt="../_images/virt-mem-pic108.png" src="../_images/virt-mem-pic108.png" style="width: 45%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 26.1 </span><span class="caption-text">4-level Memory Hierarchy</span><a class="headerlink" href="#fig-vm-fig108" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>To access address A:</p>
<p>1.) If it’s not in the cache, then the old cache line is evicted, and A is
loaded into the resulting empty cache line, this is done in hardware.</p>
<p>2.) If it’s not in memory, then the old page is evicted, and the page
containing A is loaded into the resulting empty page, this is done in software.</p>
<p>3.) This page is mapped into the faulting virtual page via the page table entry,
this is done in software.</p>
<p>In general, this works because of <em>locality</em>: when a cache line is
brought in from memory, a page is loaded into in memory from disk, etc.,
it tends to get accessed multiple times before eviction.</p>
<p>Decades ago this was used to run programs much bigger than physical
memory—CPUs were slow and disks were almost as fast as they are today,
so the relative overhead of paging infrequently-used data to disk was
low. Today’s CPUs are thousands of times faster, while disks are only a
few times faster, and virtual memory doesn’t seem like such a great idea
anymore. However it still gets used, even on desktop and laptop systems,
to “steal” memory from idle programs: if you leave a large program like
Chrome or Microsoft Word idle for half an hour while you use another
memory-hungry program, memory will be released from the idle process and
given to the active one; if you switch back, the original program will
run slowly for a while as it swaps these pages back in.</p>
</section>
<section id="dirty-and-clean-pages">
<h2><span class="section-number">26.2. </span>Dirty and Clean Pages<a class="headerlink" href="#dirty-and-clean-pages" title="Permalink to this headline">#</a></h2>
<p>How does the operating system determine whether a page has been modified
and needs to be written to disk? It uses the D bit in the page table
entry for this, as seen in
<span class="xref myst">[fig:vm:pic106]</span>{reference-type=”autoref”
reference=”fig:vm:pic106”}. When a page is mapped in the page table, the
D bit in the PTE is set to zero; when the CPU writes to a page with D =
0, the MMU re-writes the page table entry with D = 1. When the OS
decides to evict a page, the D bit tells it whether the page is “clean,”
i.e., it hasn’t been modified, or whether it is “dirty” and has to be
written back to disk.</p>
<p>When the OS is paging in from a file (e.g. executable code), it is
straightforward to find the data to read in, as there is a direct
mapping between a range of pages in a specific file and corresponding
pages in the virtual memory space. This correspondence can easily be
stored in the definition of that virtual address segment. When pages are
saved to swap space this doesn’t work, however, as the locations they
are saved to are allocated dynamically and fairly arbitrarily.</p>
<p>This problem is solved by using the page table itself. After evicting a
page, its page table entry is invalidated by setting P = 0; however, the
other 31 bits of the entry are ignored by the MMU. These bits are used
to store the location of the page in swap space, so it can be found
later later at page fault time. Thus, the page table entry does dual
duty: when the page is present it points to the physical page itself,
and is interpreted by the MMU; otherwise, it points to a location in
swap space, and is ignored by the MMU and used by the software page
fault handler.</p>
</section>
<section id="page-replacement">
<h2><span class="section-number">26.3. </span>Page Replacement<a class="headerlink" href="#page-replacement" title="Permalink to this headline">#</a></h2>
<p>If there’s a limited amount of memory available, then every time a page
is swapped in from disk, it will be necessary to remove, or evict,
another page from memory. The choice of which page to evict is
important: the best page to choose would be one that won’t be needed
anymore, while the worst page to evict would be one of the next to be
used. (in that case, paging it back in would force another page to be
evicted, and the work of paging it out and back in again would be
wasted.) In fact, replacement of items in a cache is a general problem
in computer systems; examples include:</p>
<div class="highlight-itemize* notranslate"><div class="highlight"><pre><span></span>Cache line replacement in the hardware CPU cache

Entry replacement in the TLB

Buffer replacement in a file system buffer pool

Page replacement in virtual memory
</pre></div>
</div>
<p>The page replacement problem can be stated in abstract form:</p>
<p>Given the following:</p>
<ul class="simple">
<li><p>A disk holding <span class="math notranslate nohighlight">\(d\)</span> (virtual) pages, with virtual addresses
<span class="math notranslate nohighlight">\(0,\ldots d-1\)</span>;</p></li>
<li><p>A memory <span class="math notranslate nohighlight">\({M}\)</span> consisting of <span class="math notranslate nohighlight">\(m\)</span> (physical) pages, where each page is
either empty or holds one of the <span class="math notranslate nohighlight">\(d\)</span> virtual pages, and</p></li>
<li><p>An access pattern <span class="math notranslate nohighlight">\(a_1, a_2, a_3, \cdots\)</span> where each <span class="math notranslate nohighlight">\(a_i\)</span> is a virtual
address in the range <span class="math notranslate nohighlight">\((0,d-1)\)</span>:</p></li>
</ul>
<p>a demand-paging strategy is an algorithm which for each access <span class="math notranslate nohighlight">\(a_i\)</span>
does the following:</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(a_i\)</span> is already in one of the <span class="math notranslate nohighlight">\(m\)</span> physical pages in <span class="math notranslate nohighlight">\({M}\)</span> (i.e. a
<em>hit</em>): do nothing</p></li>
<li><p>Otherwise (a miss) it must:</p></li>
<li><p>Select a physical page <span class="math notranslate nohighlight">\(j\)</span> in <span class="math notranslate nohighlight">\({M}\)</span> (holding some virtual address <span class="math notranslate nohighlight">\(M_j\)</span>)
and evict it, then</p></li>
<li><p>Fetch virtual page <span class="math notranslate nohighlight">\(a_i\)</span> from disk into physical page <span class="math notranslate nohighlight">\(j\)</span></p></li>
</ul>
<p>In other words it only fetches page <span class="math notranslate nohighlight">\(j\)</span> <em>on demand</em>—i.e. in response
to a request for it.</p>
</section>
<section id="page-replacement-strategies">
<h2><span class="section-number">26.4. </span>Page Replacement Strategies<a class="headerlink" href="#page-replacement-strategies" title="Permalink to this headline">#</a></h2>
<p>In this class we consider the following page replacement strategies:</p>
<ul class="simple">
<li><p>FIFO: <em>first-in first-out</em>. The page evicted from memory is the first
page to have been fetched into memory.</p></li>
<li><p>LRU: <em>least-recently used</em>. Here, accesses to each page are tracked
after it has been loaded into memory, and the least-recently-used page
is evicted (unsurprisingly, given the name of the strategy).</p></li>
<li><p>OPT: this is the optimal demand-paged strategy, which is simple but
impossible to implement, since it requires knowledge of the future. It’s
examined because it provides a way of telling how well a real
replacement strategy is performing—is it close to OPT, or is it far
worse?</p></li>
</ul>
<section id="fifo">
<h3><span class="section-number">26.4.1. </span>FIFO<a class="headerlink" href="#fifo" title="Permalink to this headline">#</a></h3>
<p><img alt="FIFO cleaning" src="../_images/virt-mem-pic107.png" />{#fig:vm:pic107 width=”100%”}</p>
<p>This strategy is very simple to implement, as it only requires keeping
track of the order in which pages were fetched into memory. Given 4
pages in physical memory, and the following access pattern:</p>
<p>1 2 3 4 2 1 3 4 5 4 1 2 5 6 3 2 5 2 3 6</p>
<p>The contents of memory after each access is shown in
<span class="xref myst">[fig:vm:pic107]</span>{reference-type=”autoref”
reference=”fig:vm:pic107”}, with hits shown in light grey and pages
evicted (when misses occur) shown in dark grey.</p>
<p><img alt="LRU cleaning" src="../_images/virt-mem-pic109.png" />{#fig:vm:pic109 width=”100%”}</p>
</section>
<section id="lru">
<h3><span class="section-number">26.4.2. </span>LRU<a class="headerlink" href="#lru" title="Permalink to this headline">#</a></h3>
<p>The idea behind LRU is that pages which have been accessed in the recent
past are likely to be accessed in the near future, and pages which
haven’t, aren’t. LRU replacement is shown in
<span class="xref myst">[fig:vm:pic109]</span>{reference-type=”autoref”
reference=”fig:vm:pic109”}.</p>
<p>To make the operation of the LRU algorithm more clear, on each hit, the
accessed page is moved to the top of the column. (This is how LRU is
typically implemented in software: elements are kept in a list, and on
access, an element is removed and reinserted at the front of the list.
The least-recently-used element may then be found by taking the tail of
the list) Although this is a small example, a performance improvement is
noted, with four misses compared to six for FIFO.</p>
<p><img alt="optimal cleaning" src="../_images/virt-mem-pic110.png" />{#fig:vm:pic110
width=”100%”}</p>
</section>
<section id="opt">
<h3><span class="section-number">26.4.3. </span>OPT<a class="headerlink" href="#opt" title="Permalink to this headline">#</a></h3>
<p>The optimal algorithm picks a page to evict by looking forward in time
and finding the page which goes for the longest time without being
accessed again. Except for seeing the future, OPT plays by the same
rules as other demand-paging algorithms: in particular, it can’t fetch a
page until it is accessed. (That’s why the OPT strategy still has
misses.) OPT is shown in
<span class="xref myst">[fig:vm:pic110]</span>{reference-type=”autoref”
reference=”fig:vm:pic110”}, using the same access pattern as before. The
first eviction decision is shown graphically: pages 4, 2, and 1 are
accessed 1, 3, and 2 steps in the future, respectively, while page 3
isn’t accessed for 6 steps and is thus chosen to be evicted.</p>
<p><br />
<img alt="image" src="../_images/virt-mem-pic111.png" />{width=”\textwidth”}</p>
<p><img alt="CLOCK Algorithm" src="../_images/virt-mem-pic112.png" />{#fig:vm:pic112
width=”\textwidth”}</p>
</section>
<section id="fifo-with-second-chance-clock">
<h3><span class="section-number">26.4.4. </span>FIFO with Second Chance (CLOCK)<a class="headerlink" href="#fifo-with-second-chance-clock" title="Permalink to this headline">#</a></h3>
<p>LRU is simple and quite effective in many caching applications, and it’s
ideal that the operating system uses it to determine which pages to
evict from memory. But there is one small problem in using it in a
virtual memory system: in this case, a “miss” corresponds to a page
fault and fetching a page from disk, while a “hit” is when the page is
already mapped in memory and the access succeeds in hardware. This means
that once a page is faulted into memory, any further use of that page is
“invisible” to the operating system. If the OS doesn’t know when a page
was last used, it can’t implement the Least-Recently-Used replacement
strategy.</p>
<p>Despite this issue, it’s still possible to do better than FIFO by using
the A (“accessed”) bit in the page table entry, which indicates whether
the page has been accessed since the last time the bit was cleared[^18].
In <span class="xref myst">[fig:vm:pic111]</span>{reference-type=”autoref”
reference=”fig:vm:pic111”} we see an algorithm called “FIFO with second
chance,” where the A bit is used to determine whether a page has been
accessed while it was in the FIFO queue. If the A bit is 1, the
replacement algorithm clears it and re-writes the page table entry, and
the page is given “another chance,” i.e., it is cycled back to the head
of the list. If the A bit is 0, then there have been no accesses to the
page during its entire trip through the list, and so it is selected for
replacement.</p>
</section>
<section id="clock">
<h3><span class="section-number">26.4.5. </span>CLOCK<a class="headerlink" href="#clock" title="Permalink to this headline">#</a></h3>
<p>An alternate way of visualizing the FIFO with second chance algorithm is
shown in <span class="xref myst">[fig:vm:pic112]</span>{reference-type=”autoref”
reference=”fig:vm:pic112”}. Pages are arranged in a circle, with a
“hand” advancing around the circle testing pages and determining whether
to keep or evict them. This description is the origin of the widely-used
name for this algorithm, CLOCK.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./mm"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="page-tables.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">25. </span>Page Tables</p>
      </div>
    </a>
    <a class="right-next"
       href="page-size.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">27. </span>Page Sizes</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-memory-hierarchy">26.1. The Memory Hierarchy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dirty-and-clean-pages">26.2. Dirty and Clean Pages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#page-replacement">26.3. Page Replacement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#page-replacement-strategies">26.4. Page Replacement Strategies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fifo">26.4.1. FIFO</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lru">26.4.2. LRU</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#opt">26.4.3. OPT</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fifo-with-second-chance-clock">26.4.4. FIFO with Second Chance (CLOCK)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#clock">26.4.5. CLOCK</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By (see contributing chapter book)
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>